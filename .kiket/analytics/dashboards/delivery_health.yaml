model_version: "1.0"
dashboard:
  id: delivery-health
  name: Delivery Health
  description: Cycle time, throughput, and utilisation metrics refreshed by dbt for scrum teams.
  widgets:
    - id: cycle-time-trend
      type: timeseries
      title: Cycle Time (Days)
      query: fct_cycle_time
      query_config:
        model: fct_cycle_time
        parameters:
          - name: project_id
            type: integer
            required: true
        filters:
          project_id: ":project_id"
        order_by:
          - completed_on
      visualization:
        x: completed_on
        y: avg_cycle_days
        series: project_id
    - id: throughput-trend
      type: timeseries
      title: Completed Issues by Day
      query: fct_throughput
      query_config:
        model: fct_throughput
        parameters:
          - name: project_id
            type: integer
            required: true
        filters:
          project_id: ":project_id"
        order_by:
          - completed_on
      visualization:
        x: completed_on
        y: issues_completed
    - id: throughput-kpi
      type: kpi
      title: Issues Completed (Last 7 Days)
      query: fct_throughput
      query_config:
        model: fct_throughput
        parameters:
          - name: project_id
            type: integer
            required: true
        filters:
          project_id: ":project_id"
        order_by:
          - completed_on
      options:
        window: 7d
    - id: usage-events-table
      type: table
      title: Usage Events (Last 14 Days)
      query: fct_usage_events
      query_config:
        model: fct_usage_events
        parameters:
          - name: project_id
            type: integer
            required: true
        filters:
          project_id: ":project_id"
        select:
          - recorded_on
          - metric
          - total_quantity
        order_by:
          - recorded_on DESC
        limit: 14
  alerts:
    - query: fct_cycle_time
      query_config:
        model: fct_cycle_time
        parameters:
          - name: project_id
            type: integer
            required: true
        filters:
          project_id: ":project_id"
      condition: avg_cycle_days > 5
      notify_roles:
        - manager
    - query: fct_throughput
      query_config:
        model: fct_throughput
        parameters:
          - name: project_id
            type: integer
            required: true
        filters:
          project_id: ":project_id"
        order_by:
          - completed_on DESC
        limit: 7
      condition: issues_completed < 5
      notify_roles:
        - manager
